{"version":3,"sources":["webpack:///node_modules/@stripe/stripe-js/dist/stripe.esm.js","webpack:///src/app/shared/components/payment-method-form/payment-method-form.component.html","webpack:///src/app/shared/components/payment-method-form/payment-method-form.component.ts","webpack:///src/app/shared/components/payment-method-form/stripe-elements.style.ts"],"names":["_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","i","arr2","length","iter","Symbol","iterator","Object","prototype","toString","call","from","TypeError","V3_URL","injectScript","script","document","createElement","src","headOrBody","head","body","Error","appendChild","registerWrapper","stripe","_registerWrapper","name","version","stripePromise","loadScript","Promise","resolve","reject","window","Stripe","querySelector","concat","addEventListener","initStripe","maybeStripe","args","apply","stripePromise$1","then","loadCalled","err","console","warn","loadStripe","_len","arguments","_key","STRIPE_KEY","PaymentMethodFormComponent","fns","isLoading","mountCard","card","cardValidate","cardAvailable","focus","promise","on","error","cardErrors","message","elements","create","style","mount","cardElement","nativeElement","e","preventDefault","createSource","source","callable","httpsCallable","sourceId","id","toPromise","res","log","onSubmit","templateUrl","styleUrls","read","PaymentSourceFormModule","declarations","imports","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor"],"mappings":"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","file":"payment-method-form-payment-method-form-component-es5.c73a21691c3a4849583f.js","sourcesContent":["function _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nvar V3_URL = 'https://js.stripe.com/v3';\n\nvar injectScript = function injectScript() {\n  var script = document.createElement('script');\n  script.src = V3_URL;\n  var headOrBody = document.head || document.body;\n\n  if (!headOrBody) {\n    throw new Error('Expected document.body not to be null. Stripe.js requires a <body> element.');\n  }\n\n  headOrBody.appendChild(script);\n  return script;\n};\n\nvar registerWrapper = function registerWrapper(stripe) {\n  if (!stripe || !stripe._registerWrapper) {\n    return;\n  }\n\n  stripe._registerWrapper({\n    name: 'stripe-js',\n    version: \"1.3.2\"\n  });\n};\n\nvar stripePromise = null;\nvar loadScript = function loadScript() {\n  // Ensure that we only attempt to load Stripe.js at most once\n  if (stripePromise !== null) {\n    return stripePromise;\n  }\n\n  stripePromise = new Promise(function (resolve, reject) {\n    if (typeof window === 'undefined') {\n      // Resolve to null when imported server side. This makes the module\n      // safe to import in an isomorphic code base.\n      resolve(null);\n      return;\n    }\n\n    if (window.Stripe) {\n      resolve(window.Stripe);\n      return;\n    }\n\n    var script = document.querySelector(\"script[src=\\\"\".concat(V3_URL, \"\\\"], script[src=\\\"\").concat(V3_URL, \"/\\\"]\")) || injectScript();\n    script.addEventListener('load', function () {\n      if (window.Stripe) {\n        resolve(window.Stripe);\n      } else {\n        reject(new Error('Stripe.js not available'));\n      }\n    });\n    script.addEventListener('error', function () {\n      reject(new Error('Failed to load Stripe.js'));\n    });\n  });\n  return stripePromise;\n};\nvar initStripe = function initStripe(maybeStripe, args) {\n  if (maybeStripe === null) {\n    return null;\n  }\n\n  var stripe = maybeStripe.apply(void 0, _toConsumableArray(args));\n  registerWrapper(stripe);\n  return stripe;\n};\n\n// own script injection.\n\nvar stripePromise$1 = Promise.resolve().then(loadScript);\nvar loadCalled = false;\nstripePromise$1[\"catch\"](function (err) {\n  if (!loadCalled) {\n    console.warn(err);\n  }\n});\nvar loadStripe = function loadStripe() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  loadCalled = true;\n  return stripePromise$1.then(function (maybeStripe) {\n    return initStripe(maybeStripe, args);\n  });\n};\n\nexport { loadStripe };\n","<div *ngIf=\"isLoading\">LOADING...</div>\n<form class=\"form-grid\" (submit)=\"onSubmit($event)\" [class.loading]=\"isLoading\">\n  <fieldset #cardElement class=\"stripe-card\">\n    <!-- A Stripe Element will be inserted here. -->\n  </fieldset>\n\n  <!-- Used to display Element errors. -->\n\n  <button type=\"submit\">Submit Payment</button>\n</form>\n<p>{{ cardErrors }}</p>\n","import {\n  Component,\n  ViewChild,\n  ElementRef,\n  NgModule,\n  AfterViewInit,\n} from '@angular/core';\nimport { AngularFireFunctions } from '@angular/fire/functions';\nimport { loadStripe, Stripe, StripeCardElement } from '@stripe/stripe-js';\nimport { style } from './stripe-elements.style';\nimport { CommonModule } from '@angular/common';\n\nconst STRIPE_KEY = 'pk_test_2iuUrsVhJB1IVAhu1KnRYSFA00elnKh57f';\n// declare var Stripe: stripe.StripeStatic;\n\n@Component({\n  templateUrl: './payment-method-form.component.html',\n  styleUrls: ['./payment-method-form.component.scss'],\n})\nexport class PaymentMethodFormComponent implements AfterViewInit {\n  @ViewChild('cardElement', { read: ElementRef })\n  private cardElement: ElementRef;\n  private stripe: Stripe;\n  private card: StripeCardElement;\n  cardErrors: string;\n  isLoading = true;\n\n  constructor(private fns: AngularFireFunctions) {}\n\n  async ngAfterViewInit(): Promise<void> {\n    this.card = await this.mountCard();\n    // Handle real-time validation errors from the card Element.\n    this.cardValidate();\n    await this.cardAvailable();\n    this.isLoading = false;\n    this.card.focus();\n  }\n\n  private cardAvailable() {\n    const promise = new Promise((resolve) => {\n      this.card.on('ready', async () => {\n        return resolve();\n      });\n    });\n    return promise;\n  }\n\n  private cardValidate() {\n    this.card.on('change', ({ error }) => {\n      this.cardErrors = error?.message;\n    });\n  }\n\n  async mountCard() {\n    this.stripe = await loadStripe(STRIPE_KEY);\n    const elements = this.stripe.elements();\n    const card = elements.create('card', { style });\n    card.mount(this.cardElement.nativeElement);\n    return card;\n  }\n\n  async onSubmit(e) {\n    e.preventDefault();\n\n    const { source, error } = await this.stripe.createSource(this.card, null);\n\n    if (error) {\n      // Inform the customer that there was an error.\n      this.cardErrors = error.message;\n    } else {\n      this.isLoading = true;\n      // Send the token to your server.\n      const callable = this.fns.httpsCallable('stripeAttachSource');\n      const res = await callable({ sourceId: source.id }).toPromise();\n      console.log(res);\n      this.isLoading = false;\n    }\n  }\n}\n\n@NgModule({\n  declarations: [PaymentMethodFormComponent],\n  imports: [CommonModule],\n})\nexport class PaymentSourceFormModule {}\n\n// // Submit the form with the token ID.\n// function stripeTokenHandler(token) {\n//   // Insert the token ID into the form so it gets submitted to the server\n//   var form = document.getElementById('payment-form');\n//   var hiddenInput = document.createElement('input');\n//   hiddenInput.setAttribute('type', 'hidden');\n//   hiddenInput.setAttribute('name', 'stripeToken');\n//   hiddenInput.setAttribute('value', token.id);\n//   form.appendChild(hiddenInput);\n\n//   // Submit the form\n//   form.submit();\n// }\n","export const style = {\n  base: {\n    color: '#32325d',\n    fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n    fontSmoothing: 'antialiased',\n    fontSize: '16px',\n    '::placeholder': {\n      color: '#aab7c4',\n    },\n  },\n  invalid: {\n    color: '#fa755a',\n    iconColor: '#fa755a',\n  },\n};\n"]}